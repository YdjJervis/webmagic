<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="us.codecraft.webmagic.samples.amazon.dao.UrlHistoryDao">

    <resultMap id="UrlResultMap" type="Url">
        <result property="id" column="sauh_id"/>
        <result property="urlMD5" column="sauh_url_md5"/>
        <result property="siteCode" column="BAS_CODE"/>
        <result property="saaAsin" column="saa_asin"/>
        <result property="url" column="sauh_url"/>
        <result property="parentUrl" column="sauh_parent_url"/>
        <result property="updatetime" column="sauh_update_time"/>
    </resultMap>

    <insert id="add" parameterType="Url">
        <selectKey resultType="java.lang.Long">
            SELECT @@IDENTITY AS id
        </selectKey>
        insert into spider_amazon_url_history(sauh_url_md5,BAS_CODE,saa_asin,sauh_url,sauh_parent_url)
        values(#{urlMD5},#{siteCode},#{saaAsin},#{url},#{parentUrl})
        ON DUPLICATE KEY UPDATE sauh_url_md5 = #{urlMD5}
    </insert>

    <insert id="addAll" parameterType="java.util.List">
        <selectKey resultType="java.lang.Long">
            SELECT @@IDENTITY AS id
        </selectKey>
        INSERT INTO spider_amazon_url_history(sauh_url_md5,BAS_CODE,saa_asin,sauh_url,sauh_parent_url)
        values
        <foreach collection="list" item="item" index="index" separator=",">
            (
            #{item.urlMD5},
            #{item.siteCode},
            #{item.saaAsin},
            #{item.url},
            #{item.parentUrl}
            )
        </foreach>
        ON DUPLICATE KEY UPDATE
        sauh_url_md5 = #{item.urlMD5},
        BAS_CODE = #{item.siteCode},
        saa_asin = #{item.saaAsin},
        sauh_url = #{item.url},
        sauh_parent_url=#{item.parentUrl},
        sauh_update_time=CURRENT_TIMESTAMP
    </insert>

</mapper>