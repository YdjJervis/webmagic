<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="us.codecraft.webmagic.samples.amazon.dao.AsinDao">

    <resultMap id="AsinResultMap" type="Asin">
        <id property="id" column="saa_id"/>
        <result property="siteCode" column="bas_code"/>
        <result property="asin" column="saa_asin"/>
        <result property="rootAsin" column="saa_root_asin"/>
        <result property="onSale" column="saa_on_sale"/>
        <result property="crawledHead" column="saa_crawled_head"/>
        <result property="status" column="saa_status"/>
        <result property="progress" column="saa_progress"/>
        <result property="extra" column="saa_extra"/>
        <result property="syncTime" column="saa_sync_time"/>
        <result property="createTime" column="saa_create_time"/>
        <result property="updateTime" column="saa_update_time"/>

    </resultMap>

    <select id="findAll" resultMap="AsinResultMap">
        select * from spider_amazon_asin;
    </select>

    <!--更新爬取状态和URL转换状态-->
    <update id="update" parameterType="Asin">
        UPDATE spider_amazon_asin
        SET
        saa_root_asin=#{rootAsin},saa_on_sale = #{onSale},saa_crawled_head=#{crawledHead},saa_status = #{status},
        saa_progress=#{progress},saa_extra=#{extra}
        WHERE
        bas_code = #{siteCode} and saa_asin = #{asin}
    </update>

    <select id="findByAsin" resultMap="AsinResultMap">
        select * from spider_amazon_asin
        WHERE
        bas_code = #{0} and saa_asin = #{1}
    </select>

    <select id="findByRootAsin" resultMap="AsinResultMap">
        select * from spider_amazon_asin WHERE
        saa_root_asin = #{0};
    </select>

    <!-- 查询没有爬取过产品首页的ASIN -->
    <select id="findNotRooted" resultMap="AsinResultMap">
        WHERE asin.saa_crawled_head = 0 LIMIT 1000;
    </select>

    <!-- 添加ASIN列表 -->
    <insert id="addAll" parameterType="java.util.List">
        INSERT INTO spider_amazon_asin(
        bas_code,saa_asin,saa_root_asin,saa_on_sale,saa_crawled_head,saa_status,saa_progress,saa_extra
        )
        VALUES
        <foreach collection="list" item="item" index="index" separator=",">(
            #{item.siteCode},#{item.asin},#{item.rootAsin},#{item.onSale},#{item.crawledHead},#{item.status},
            #{item.progress},#{item.extra}
            )
        </foreach>
    </insert>

</mapper>