<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="us.codecraft.webmagic.samples.amazon.dao.FollowSellDao">

    <resultMap id="FollowSellResultMap" type="FollowSellMonitor">
        <result column="smfs_id" property="id"/>
        <result column="bas_code" property="siteCode"/>
        <result column="saa_asin" property="asin"/>
        <result column="smfs_marked" property="marked"/>
        <result column="smfs_parsed" property="parsed"/>
        <result column="smfs_priority" property="priority"/>
        <result column="smfs_extra" property="extra"/>
        <result column="smfs_create_time" property="createtime"/>
        <result column="smfs_update_time" property="updatetime"/>

    </resultMap>

    <insert id="addAll" parameterType="java.util.List">
        INSERT INTO spider_monitor_follow_sell(
        bas_code,saa_asin,smfs_marked,smfs_parsed,smfs_priority,smfs_extra
        )
        VALUES
        <foreach collection="list" item="item" index="index" separator=",">
            (
            #{item.siteCode},#{item.asin},#{item.marked},#{item.parsed},#{item.priority},#{item.extra}
            )
        </foreach>
    </insert>

    <update id="update" parameterType="FollowSellMonitor">
        UPDATE spider_monitor_follow_sell SET
        smfs_marked = #{marked},smfs_parsed = {parsed},smfs_priority = {priority},smfs_extra = #{extra}
        WHERE bas_code = #{siteCode} and saa_asin = #{asin};
    </update>

    <select id="findByObject" resultMap="FollowSellResultMap">
        select * from spider_monitor_follow_sell WHERE
        bas_code = #{siteCode} and saa_asin = #{asin};
    </select>

    <select id="findNotParsed" resultMap="FollowSellResultMap">
        select * from spider_monitor_follow_sell WHERE
        smfs_marked = 1 and smfs_parsed = 0 and CURRENT_TIMESTAMP - smfs_update_time > (smfs_priority + 1) * 0;
    </select>
</mapper>