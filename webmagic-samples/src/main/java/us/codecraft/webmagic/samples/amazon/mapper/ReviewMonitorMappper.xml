<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="us.codecraft.webmagic.samples.amazon.dao.ReviewMonitorDao">

    <resultMap id="ReviewMonitorResultMap" type="ReviewMonitor">
        <id property="id" column="smr_id"/>
        <result property="smrReviewId" column="rcr_review_id"/>
        <result property="customerCode" column="bec_code"/>
        <result property="status" column="rcr_status"/>
        <result property="siteCode" column="bas_code"/>
        <result property="smrMarked" column="rcr_marked"/>
        <result property="smrParsed" column="rcr_parsed"/>
        <result property="smrPriority" column="rcr_priority"/>
        <result property="frequency" column="rcr_frequency"/>
        <result property="finishTime" column="rcr_finish_time"/>
        <result property="createTime" column="rcr_create_time"/>
        <result property="updateTime" column="rcr_update_time"/>
    </resultMap>

    <!--添加到监控-->
    <insert id="add" parameterType="ReviewMonitor">
        insert into relation_customer_review (
          rcr_review_id,
          bas_code,
          rcr_marked,
          rcr_parsed,
          rcr_priority,
          rcr_frequency
        ) values (
          #{smrReviewId},
          #{siteCode},
          #{smrMarked},
          #{smrParsed},
          #{smrPriority},
          #{frequency}
        )
    </insert>

    <!--根据ReviewId查询记录-->
    <select id="findByReviewId" resultMap="ReviewMonitorResultMap">
        SELECT * FROM relation_customer_review
        WHERE rcr_review_id = #{0};
    </select>

    <select id="findAll" resultMap="ReviewMonitorResultMap">
        SELECT * FROM relation_customer_review
        WHERE rcr_marked = 1 AND rcr_parsed = 0;
    </select>
    <select id="findByReviewIdAndCustomerCode" resultMap="ReviewMonitorResultMap">
        SELECT * FROM relation_customer_review
        WHERE rcr_review_id = #{0} and bec_code = #{1};
    </select>

    <select id="findHasFinished" resultMap="ReviewMonitorResultMap">
        SELECT
          *
        FROM
          relation_customer_review
        WHERE
          rcr_status = 2
    </select>

    <update id="update" parameterType="ReviewMonitor">
        UPDATE relation_customer_review
        SET bas_code = #{siteCode},rcr_marked = #{smrMarked},rcr_parsed = #{smrParsed},rcr_priority = #{smrPriority},rcr_frequency = #{frequency}
        WHERE rcr_review_id = #{smrReviewId}
    </update>
    <update id="updateByReviewIdCustomerCode">
        UPDATE
          relation_customer_review
        SET
          bec_code = #{customerCode},
          bas_code = #{siteCode},
          rcr_status = #{status},
          rcr_marked = #{smrMarked},
          rcr_parsed = #{smrParsed},
          rcr_priority = #{smrPriority},
          rcr_frequency = #{frequency},
          rcr_finish_time = #{finishTime}
        WHERE
          rcr_review_id = #{smrReviewId} and bec_code = #{customerCode}
    </update>

    <insert id="addAll" parameterType="java.util.List">
        INSERT INTO relation_customer_review (
          rcr_review_id,
          bec_code,
          bas_code,
          rcr_marked,
          rcr_parsed,
          rcr_priority,
          rcr_frequency
        )
        VALUES
        <foreach collection="list" item="item" index="index" separator=",">
            (
              #{item.smrReviewId},
              #{item.customerCode},
              #{item.siteCode},
              #{item.smrMarked},
              #{item.smrParsed},
              #{item.smrPriority},
              #{item.frequency}
            )
        </foreach>
    </insert>

</mapper>