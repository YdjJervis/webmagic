<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="us.codecraft.webmagic.samples.amazon.dao.ReviewMonitorDao">

    <resultMap id="ReviewMonitorResultMap" type="ReviewMonitor">
        <result property="smrReviewId" column="smr_review_id"/>
        <result property="siteCode" column="bas_code"/>
        <result property="smrMarked" column="smr_marked"/>
        <result property="smrParsed" column="smr_parsed"/>
        <result property="smrPriority" column="smr_priority"/>
        <result property="createTime" column="smr_create_time"/>
        <result property="updateTime" column="smr_udpate_time"/>
    </resultMap>

    <!--添加到监控-->
    <insert id="add" parameterType="ReviewMonitor">
        insert into spider_monitor_review(smr_review_id,bas_code,smr_marked,smr_parsed,smr_priority)
        values(#{smrReviewId},#{siteCode},#{smrMarked},#{smrParsed},#{smrPriority})
    </insert>

    <!--根据ReviewId查询记录-->
    <select id="findByReviewId" resultMap="ReviewMonitorResultMap">
        SELECT * FROM spider_monitor_review
        WHERE smr_review_id = #{0};
    </select>

    <select id="findAll" resultMap="ReviewMonitorResultMap">
        SELECT * FROM spider_monitor_review
        WHERE smr_marked = 1 AND smr_parsed = 0;
    </select>

    <update id="update" parameterType="ReviewMonitor">
        UPDATE spider_monitor_review
        SET bas_code = #{siteCode},smr_marked = #{smrMarked},smr_parsed = #{smrParsed},smr_priority = #{smrPriority}
        WHERE smr_review_id = #{smrReviewId}
    </update>

    <insert id="addAll" parameterType="java.util.List">
        INSERT INTO spider_monitor_review(
        smr_review_id,bas_code,smr_marked,smr_parsed,smr_priority
        )
        VALUES
        <foreach collection="list" item="item" index="index" separator=",">
            (
            #{item.smrReviewId},#{item.siteCode},#{item.smrMarked},#{item.smrParsed},#{item.smrPriority}
            )
        </foreach>
    </insert>

</mapper>